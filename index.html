<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>VisionID</title>

<script src="https://cdn.tailwindcss.com"></script>
<script src="https://unpkg.com/lucide@latest"></script>

<!-- MediaPipe -->
<script src="https://cdn.jsdelivr.net/npm/@mediapipe/face_detection/face_detection.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@mediapipe/camera_utils/camera_utils.js"></script>

</head>

<body class="bg-slate-900 text-slate-100">

<nav class="bg-slate-950 border-b border-slate-800 p-4 flex items-center gap-3">
    <i data-lucide="eye" class="text-blue-500 w-7 h-7"></i>
    <span class="font-bold text-lg">VisionID</span>
</nav>

<main class="p-4 max-w-md mx-auto">

    <h1 class="text-2xl font-bold text-center mb-4 text-blue-400">
        Seguran√ßa por Vis√£o Computacional
    </h1>

    <!-- CAMERA -->
    <div class="relative bg-black rounded-xl overflow-hidden border border-slate-700">

        <video id="camera" class="w-full h-64 object-cover hidden" autoplay playsinline></video>

        <div id="overlay" class="absolute inset-0 flex flex-col items-center justify-center text-slate-400 cursor-pointer">
            <i data-lucide="camera" class="w-14 h-14 mb-2"></i>
            <p>Toque para ativar a c√¢mera</p>
        </div>

        <div id="status" class="absolute bottom-2 left-2 bg-black/60 text-green-400 text-xs px-2 py-1 rounded">
            Sistema pronto
        </div>
    </div>

</main>

<script>
lucide.createIcons();

const video = document.getElementById("camera");
const overlay = document.getElementById("overlay");
const statusBox = document.getElementById("status");

let faceDetected = false;

async function startCamera() {
    try {
        const stream = await navigator.mediaDevices.getUserMedia({
            video: { facingMode: "environment" },
            audio: false
        });

        video.srcObject = stream;
        overlay.style.display = "none";
        video.classList.remove("hidden");

        startDetection();
    } catch (e) {
        alert("Erro ao acessar a c√¢mera.");
        console.error(e);
    }
}

overlay.onclick = startCamera;

// ---------- DETEC√á√ÉO FACIAL ----------
const faceDetection = new FaceDetection({
    locateFile: file =>
        `https://cdn.jsdelivr.net/npm/@mediapipe/face_detection/${file}`
});

faceDetection.setOptions({
    model: "short",
    minDetectionConfidence: 0.6
});

faceDetection.onResults(results => {
    if (results.detections.length > 0) {
        statusBox.textContent = "üë§ Face detectada";
        statusBox.classList.add("text-green-400");
    } else {
        statusBox.textContent = "Aguardando rosto...";
    }
});

// ---------- LOOP DE AN√ÅLISE ----------
async function startDetection() {
    const camera = new Camera(video, {
        onFrame: async () => {
            await faceDetection.send({ image: video });
        },
        width: 640,
        height: 480
    });
    camera.start();
}
</script>

</body>
</html>
